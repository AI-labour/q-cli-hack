# 调试日志说明

## 问题描述
用户报告运行 `npm run cli test "写一个快速排序算法"` 时，程序没有输出任何结果就结束了。

## 已添加的调试日志

### 1. CodeWhisperer客户端 (src/codewhisperer-client.ts)

#### API响应调试
- **响应状态**: 打印HTTP响应的状态码和状态文本
- **响应头**: 打印所有响应头信息
- **错误响应**: 如果API返回错误，打印完整的错误响应体
- **空响应体**: 如果响应体为null，打印警告信息
- **开始解析**: 确认开始解析事件流

#### 事件流解析调试
- **接收数据块**: 
  - 打印接收到的数据块编号
  - 打印每个数据块的大小（字节）
  - 打印数据块内容（前200个字符）
  
- **处理行**:
  - 打印正在处理的每一行（前100个字符）
  - 如果行不是以 "data: " 开头，打印警告
  
- **解析事件**:
  - 打印每个成功解析的事件（完整JSON）
  - 打印事件编号
  - 如果解析失败，打印错误信息
  
- **流结束**:
  - 打印总共接收的数据块数量
  - 打印总共解析的事件数量
  - 确认读取器已释放

### 2. CLI工具 (src/cli.ts)

#### 事件循环调试
- **开始迭代**: 确认开始迭代事件流
- **接收事件**: 
  - 打印接收到的每个事件（完整JSON）
  - 打印事件编号
  
- **处理事件**:
  - 如果是 assistantResponseEvent，打印确认信息
  - 如果是 codeEvent，打印确认信息
  - 如果是 messageMetadataEvent，打印确认信息
  - 如果是未知事件类型，打印事件的所有键名
  
- **迭代完成**: 打印总共接收的事件数量

## 如何使用这些调试日志

运行测试命令：
```bash
npm run cli test "写一个快速排序算法"
```

调试日志将显示：
1. 请求是否成功发送
2. API返回的状态码和响应头
3. 是否接收到数据
4. 数据是什么格式
5. 解析出了多少个事件
6. 每个事件的具体内容
7. 为什么某些事件没有被处理

## 可能的问题场景

### 场景1: API返回错误
调试日志会显示：
- 错误的HTTP状态码
- 完整的错误响应体

### 场景2: 返回空流
调试日志会显示：
- 响应状态200
- "Received 0 chunks, parsed 0 events"
- "Iteration complete. Received 0 events total"

### 场景3: 事件格式不匹配
调试日志会显示：
- 接收到的事件内容
- "Unknown event type: [...]"（列出事件的键名）

### 场景4: 解析失败
调试日志会显示：
- "Failed to parse event: ..."
- 原始的无法解析的数据

## 后续步骤

根据调试日志的输出：
1. 如果没有接收到任何数据，检查认证令牌是否有效
2. 如果接收到数据但解析失败，检查数据格式
3. 如果解析成功但事件类型不匹配，检查事件结构
4. 如果一切正常但没有输出，检查事件内容是否为空

## 修复的Bug

在添加调试日志的过程中，发现并修复了以下bug：

### chatTriggerType 值错误

**位置**: 
- `examples/basic-usage.ts` (2处)
- `examples/tool-calling.ts` (2处)

**问题**: 使用了 `'Manual'`（首字母大写），但根据 `src/types.ts` 的类型定义，正确的值应该是 `'MANUAL'`（全大写）。

**类型定义** (src/types.ts:109):
```typescript
chatTriggerType: 'MANUAL' | 'DIAGNOSTIC' | 'INLINE_CHAT';
```

**修复**: 将所有示例代码中的 `chatTriggerType: 'Manual'` 改为 `chatTriggerType: 'MANUAL'`

这个bug可能导致API调用失败或返回意外结果。

## 注意事项

这些调试日志会输出大量信息，包括完整的事件内容。这有助于诊断问题，但在生产环境中应该移除或使用环境变量控制。

如需要更清晰的输出，可以考虑：
1. 添加环境变量 `DEBUG=true` 来控制日志输出
2. 使用专门的日志库（如winston或pino）
3. 将日志输出到文件而不是控制台
